### 单点登录

什么是单点登录：⼀处登录，处处登录，⼀处登出，处处登出。
⽤户只需要登录⼀次就可以访问所有相互信任的应⽤系统。
**SSO**
Single Sign On 单点登录
企业业务整合解决⽅案
⼀票通

### SSO 原理

- 当⽤户第⼀次访问淘宝的时候，因为还没有登录，会被引导到认
  证中⼼进⾏登录。
- 根据⽤户提供的登录信息，认证系统进⾏身份验证，如果通过，
  则登录成功，并返回给⽤户⼀个认证的凭据（token）。
- 当⽤户访问天猫时，就会将这个 token 带上，作为⾃⼰认证的
  凭据。
- 应⽤系统接收到请求后会把 token 送到认证中⼼进⾏校验，检
  查 token 的合法性。
- 如果通过校验，⽤户就可以在不⽤再次登录的情况下访问天猫
  了。

### SSO 实现技术

- Cookie 单点登录

使⽤ Cookie 作为媒介，存放⽤户凭证。
⽤户登录淘宝之后，返回⼀个 token，存⼊客户端的 Cookie 中，
当⽤户访问天猫的时候，会⾃动带上 Cookie，这样 token ⼜传给
了认证中⼼，进⾏校验。

- 分布式 Session

2、⽤户再次登录时，获取分布式 Session，判断是否有登录信息，
如果没有则返回登录⻚⾯。
3、Session ⼀般存储到 Redis 中，因为它有持久化功能，如果分布
式 Session 宕机后，重启之后可以从持久化存储中重新加载会话信
息。

### SSO 常⻅⽅案

- OAuth2（第三方登录授权）

第三⽅系统访问主系统资源，⽤户⽆需将主系统的账户告知第三
⽅，只需要通过主系统的授权，第三⽅就可以使⽤主系统的资源。

- jwt

Json Web Token，是为了在⽹络应⽤之间传递信息⽽执⾏的⼀种，
基于 JSON 的开放标准，难度较⾼，需要了解很多协议，偏向底层
的东⻄，需要你基于 JWT 认证协议，⾃⼰开放 SSO 服务和权限控
制。

- CAS（不是并发的 CAS）

单点登录的 CAS 和并发的 CAS 完全是两码事
中央认证服务，Central Authentication Service
CAS 是耶鲁⼤学发起的⼀个开源项⽬，为 Web 应⽤系统提供单点
登录的解决⽅案，实现多个系统只需要登录⼀次，⽆需重复登录。

- CAS Server
- CAS Client

Server 和 Client 分别独⽴部署，Server 主要负责认证⼯作
Client 负责处理对客户端资源的访问请求，需要登录时，重定向到
Server 进⾏认证。
1、授权服务器保存⼀个全局 session，多个客户端各⾃保存⾃⼰的
session。
2、客户端登录时判断⾃⼰的 session 是否已经登录，如果没有登
录，则重定向到服务器进⾏授权（带上⾃⼰的地址，⽤于回调）。
3、授权服务器判断全局的 session 是否已经登录，如果未登录则
重定向到登录⻚⾯，提供⽤户登录，登录成功之后，授权服务器重
定向到客户端，带上 ticket。
4、客户端收到 ticket 后，请求服务器获取⽤户信息。
5、服务器同意客户端授权后，服务器保存⽤户信息到全局
session，客户端将⽤户信息保存⾄本地 session。

### 手写单点登录系统架构

Cookie 单点登录的实现（更注重底层）

用到的技术框架：Spring Boot + Thymelaf

在父工程下创建三个子模块（maven模块）：

- taobao              sso_client_taobao

- tmall                  sso_client_tmall

- server                sso_server










